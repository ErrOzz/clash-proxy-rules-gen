mixed-port: 7890
allow-lan: false
mode: rule
log-level: info
# external-controller: 127.0.0.1:9090

# --- GeoX Data Sources ---
geodata-mode: false
geox-url:
  geosite: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"

geo-auto-update: true
geo-update-interval: 24 # in hours

dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - '*.local'
  nameserver:
    - https://dns.google/dns-query
    - https://cloudflare-dns.com/dns-query
    - https://dns.adguard-dns.com/dns-query # Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ Ñ€ĞµĞºĞ»Ğ°Ğ¼Ñƒ
  fallback:
    - https://dns.quad9.net/dns-query
    - tls://1.1.1.1:853
  use-system-hosts: true
  default-nameserver:
    - 8.8.8.8
    - 1.1.1.1

proxies:
  # Iterate through all generated proxies (Panel + Extra)
  {% for proxy in all_proxies -%}
  - {{ proxy | to_yaml | indent(4) }}
  {%- if not loop.last %}

  {% endif -%}
  {% endfor %}

proxy-groups:
  # 1. Automatic Selection: Checks ping and selects the fastest server
  - name: â™»ï¸ Automatic
    type: fallback
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    proxies:
      {% for proxy in all_proxies -%}
      - {{ proxy.name }}
      {% endfor -%}
      - DIRECT

  # 2. Main Proxy Selector: Choose between Auto or specific server manually
  - name: ğŸš€ PROXY
    type: select
    proxies:
      - â™»ï¸ Automatic
      {% for proxy in all_proxies -%}
      - {{ proxy.name }}
      {% endfor %}
  # 3. Fallback Selector: For traffic not matched by rules (Your 'OTHER' logic)
  - name: ğŸŸ OTHER
    type: select
    proxies:
      - DIRECT
      - ğŸš€ PROXY

rule-providers:
  proxy_domains:
    behavior: classical
    type: http
    url: "{{ rule_provider_url }}"
    interval: 3600 # in seconds
    path: ./proxy_domains.yaml # Lockal rule file name

rules:
  - IP-CIDR,10.0.0.0/24,DIRECT
  - IP-CIDR,100.64.0.0/22,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT
  - DOMAIN-SUFFIX,local,DIRECT
  - DOMAIN-SUFFIX,localhost,DIRECT

  - RULE-SET,proxy_domains,ğŸš€ PROXY

  # messaging and social media
  - GEOSITE,telegram,ğŸš€ PROXY
  - GEOIP,telegram,ğŸš€ PROXY,no-resolve
  - GEOSITE,whatsapp,ğŸš€ PROXY
  - GEOIP,whatsapp,ğŸš€ PROXY,no-resolve
  - GEOSITE,signal,ğŸš€ PROXY
  - GEOIP,signal,ğŸš€ PROXY,no-resolve
  - GEOSITE,discord,ğŸš€ PROXY
  - GEOIP,discord,ğŸš€ PROXY,no-resolve
  
  # social media and content platforms
  - GEOSITE,facebook,ğŸš€ PROXY
  - GEOSITE,instagram,ğŸš€ PROXY
  - GEOSITE,linkedin,ğŸš€ PROXY
  - GEOSITE,twitter,ğŸš€ PROXY
  - GEOSITE,youtube,ğŸš€ PROXY

  # ai and developer platforms
  - GEOSITE,google-gemini,ğŸš€ PROXY
  - GEOSITE,openai,ğŸš€ PROXY
  - GEOSITE,xai,ğŸš€ PROXY
  - GEOSITE,anthropic,ğŸš€ PROXY
  - GEOSITE,github,ğŸš€ PROXY

  - GEOIP,RU,DIRECT

  - MATCH,ğŸŸ OTHER